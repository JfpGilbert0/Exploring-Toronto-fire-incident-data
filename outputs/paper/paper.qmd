---
title: "Melting snow: Exploring Toronto Fire Incident Data"
author: 
  - Jacob Gilbert
thanks: "Code and data are available at: [LINK](https://github.com/JfpGilbert0/Exploring-Toronto-fire-incident-data)"
date: today
date-format: long
abstract: "Fire events pose a significant challenge in urban inviroments, as a threat to property and public safety. Understanding the frequency and costs of fire damage is essential for urban planners and local government to prepare and prevent such incidents."
format: pdf
number-sections: true
bibliography: references.bib
---
# table of contents

\newpage

# Introduction

Fire incidents have and will pose a significant problem to the welbeing of public health and the inferstructure of urban areas. Understanding the patterns and characteristics is essential for policy makes to implement preventative measures. In the ever growing city of Toronto, where population is set to grow 45% across the Greater Toronto Area by 2046 (@citeontario), the importance of this is ever prevailent.

Prevention of fires is a multifaceted challenge with many unpredictable factors, thus understanding the information we have is essential. Building infastructure, common causes and enviromental factors can all play a part. In a densely populated city the concentration and constant evolution of structures create additional challenges. New buildings and kyscrapers are on the rise in Toronto for residential and industrial purposes and as such a proactive approach is essential for minimilizing losses.

With such a large geographical area to cover, the GTA  divides its emergency services geographically. Differenct stations responding to incidents within their surrounding area as to not overencomber each location. With the cahnges mentions to population size and density in many areas of Toronto the demands for different areas are likely to change. As a result policy makers will need to understand were this demand is required most to make efficient responses.

In the following analysis aims to provide valuable insights for policy makers, emphazising areas of increased frequency and bringing attention to hotspots for areas of increased fiscal damage. Doing this both by geographic location aswell as by location use.


we will break down the financial impacts of fire incident data provided by opendatatoronto. Gaining insights into the types of locations that are most commonly affected and those that experience more severe damage. also gaining insights into how the data changes in downtown enviroments. 

The analysis will be done using R (@citeR) using dplyr (@citedplyr), sf (@citesf), janitor (@janitor) and tidyverse (@citetidyverse) . All graphs were generated by ggplot2 (@citegg)




# Data {#sec-data}

The following report uses fire incident data opendatatoronto @opendatatoronto 
obtained through City of TOronto's open data portal,

[ talk about the data where its from....]

[good things about the data and how it is very complete except those under investigation]

[any problems with the data (how it was cleaned I guesss)]

[what parts of teh data was actually used in this analysis
long/lat
CAD event type - highlight what part of this was used
setback of this
initial ignition source - again setbacks of this

]




and includes fire incidents as defined by the Ontario Fire Marshal (OFM) up to December 31st, 2022. The Dataset included much information but for this analysis we will be focusing on the Computer Aided Dispatch event types data and the estimated dollars lost as this data will provide insight into were the costly incidents are taking place. Further we will look into these high costing locations analysing the source of these events to better understand why some locations host more frequent and costly incidents. This data is not available for all events thus some of the data is undetermined. 

In the figures below some data is ommited as outliers to tell a clear story with the data. Further many insignificant variables are grouped into a single catagory. This is so to focus the analysis on those factors  that are contributing significantly to the data.


```{r}
#| echo: false
#| warning: false
#| message: false
#### Workspace setup ####
library(tidyverse)
library(janitor)
library(ggplot2)
library(dplyr)
library(sf)
library(opendatatoronto)

#### Read data ####
fire_event_data <- read_csv(here::here("outputs/data/fire_event_data.csv"))

#### Create fire stations map ####

toronto <- list_package_resources("neighbourhoods") |>
  filter(name == "Neighbourhoods - historical 140 - 4326.zip") |>
  get_resource()

fire_stations <-
  list_package_resources("a6ce5495-8e2b-421a-ab11-964569416f31") |>
  filter(name == "fire-station-locations - 4326.zip") |>
  get_resource()

fire_cost <-
  filter(fire_event_data, estimated_dollar_loss != 0)

sf_data <-
  st_as_sf(fire_cost, coords =  c("longitude", "latitude"), crs = 4326)



```


# Analysis


This data shows where across the GTA most fire incidences are occuring giving a clear understanding of where the most common places fire incidences occur. Locations outside or holding garbage are clear hotspots from this graph however as figure 2 shows the damage being done here is not as damaging as fires in other locations. This is not unexpected as damage originating garbage or grass fires are unlikely to be heavily represented in financial data. For policy makers this information should highlight an area that is in need of a solution. As figure 2 shows financially the benefit is prioritizing other types of incidents.

We see the areas of true damage is occuring in these industrial and residential incidents. These are not only the area of financial concern but also where the safety of the populus is most at risk. 


```{R}
#| label: Incident Damages
#| fig-cap: Fires in toronto, size of point represents estimated dollar lost of fire, with higher density and costs towords downtown
#| echo: false
#| warning: false
#| message: true


### Geographic  cost ###

map <- ggplot() +
  geom_sf(data = toronto, fill = "white", show.legend = TRUE) +
  geom_sf(data = fire_stations, color = "darkgreen", size = 0.5, alpha = 3, show.legend = TRUE) +
  geom_sf(data = sf_data, aes(color = fire_cost$is_not_property), alpha = 0.2,
          size = pmin(0.7*fire_cost$estimated_dollar_loss / mean(fire_cost$estimated_dollar_loss),2),
          show.legend = TRUE) +
  labs(
    x = "latitude",
    y = "longitude"
  ) +
  theme_minimal() +
  scale_color_manual(
    name = "Buildings",
    values = c("blue", "red"),
    labels = c("blue" = "Not a Building", "red" = "Building affected")
  ) +

  theme(
    axis.title = element_text(size = 4),
    axis.text.x = element_text(size = 3),
    axis.text.y = element_text(size = 3),
    legend.position = "right",
    legend.text = element_text(size = 3),
    legend.title = element_text(size = 4),
    legend.key.height = unit(0.5, "cm"),
    legend.key.width = unit(0.5, "cm"))

print(map)

```


```{r}
#| label: Histogram
#| fig-cap: Histogram of fire incident cost seperated by indoor and outdoor events, with large left skew
#| echo: false
#| warning: false
#| message: true

histo_cost <-
  ggplot(fire_event_data, aes(x = pmin(estimated_dollar_loss, 10000), fill = is_not_property)) +
    geom_histogram(bins = 10, position = "identity", alpha = 0.6) +
    scale_fill_manual(
      values = c("blue", "red"),
      name = "fire location",
      labels = c("outside", "Building affected")
    ) +
    theme_minimal() +
    labs(
      x = "Estimated Dollar Loss",
      y = "Frequency"
    )

print(histo_cost)
```

[shows the histogram gives clearer picture of things stated in the map by withought the location aspect togethe you get a cear view that the buiding fire hotspot of downtown is a clear problem area for mitigating damage whereas the suburbs with far less building related fires which are doing very minimal damage are not as big a problem. even with a few outliers in the data downtown is clearly the place to mitigate damage.]

### hour of day

```{r}
#| label: histogram by hour
#| fig-cap: frequency of fire incidents by hour, highest frequency later in the evening
#| echo: false
#| warning: false
#| message: true

### Hour of day histogaph

hour_histo <- ggplot(fire_event_data, aes(x = hour)) +
  geom_histogram(binwidth = 1, fill = "darkblue", color = "black", alpha = 0.7) +
  labs(title = "Fire Incidents by Hour of Day",
       x = "Hour of Day",
       y = "Count") +
  theme_minimal()

# Print the histogram
print(hour_histo)

```

```{r}
#| label: ignition sources
#| fig-cap: pie chart of the top 10 most common ignition sources 
#| echo: false
#| warning: false
#| message: true

top_ignition_values <- fire_event_data %>%
  count(ignition_source, sort = TRUE) %>%
  slice_head(n = 10) %>%
  pull(ignition_source)

subset_data <- select(filter(fire_event_data, !is.na(ignition_source)), c("ignition_source", "estimated_dollar_loss")) %>%
  filter(ignition_source %in% top_ignition_values)

top_ignition_sources <- subset_data %>%
  group_by(ignition_source) %>%
  summarise(count = n())

pie_chart <- ggplot(top_ignition_sources, aes(x = "", y = count, fill = ignition_source , label = ignition_source)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  labs(title = "Pie Chart of Ignition Sources") +
  theme_minimal()

print(pie_chart)
```


data will show what preventitive measures to focus on to mitigate damages in properties where costs are highest aswell as lives...

## conclusion

this paper has given insight into geographic locations that generate hotspots for fire frequency 


[] Highlight how residential downtown is the highest threat area and cost in downtown
[] look at causes of the fires in next fig 
[] policy makes can highlight these as focuses on safety in the highly populated areas


