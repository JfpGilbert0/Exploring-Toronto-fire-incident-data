---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - First author
  - Another author
thanks: "Code and data are available at: LINK."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

# Introduction

Fire events pose a significant challenge in urban inviroments, as a threat to property and public safety. Understanding the frequency and costs of fire damage is essential for urban planners and local government to prepare and prevent such incidents. This is especially important in Toronto's downtown area which is home to approximately 16,000 people per square kilometer ().

In the following analysis we will break down the financial impacts of these events from fire incident data provided by opendatatoronto. Gaining insights into the types of locations that are most commonly affected and those that experience more severe damage. also gaining insights into how the data changes in downtown enviroments. 

The analysis will be done using R (@citeR) using dplyr (@citedplyr) and tidyverse (@citetidyverse). All graphs were generated by ggplot2 (@citegg)

The data is provided by opendatatoronto @opendatatoronto and includes fire incidents as defined by the Ontario Fire Marshal (OFM) up to December 31st, 2022.



You can and should cross-reference sections and sub-sections. 

The remainder of this paper is structured as follows. @sec-data....



# Data {#sec-data}

Some of our data is of penguins (@fig-bills), from @palmerpenguins.


```{r}
#| echo: false
#| warning: false
#| message: false
#### Workspace setup ####
library(tidyverse)
library(ggplot2)
library(dplyr)

#### Read data ####
fire_event_data <- read_csv(here::here("outputs/data/fire_event_data.csv"))

### Model data ####

non_downtown_data <- fire_event_data %>%
  filter(is_downtown == 0)
downtown_data <- fire_event_data %>%
  filter(is_downtown == 1)

fire_event_costs <-
  select(fire_event_data, c("location", "estimated_dollar_loss")) %>%
  group_by(location) %>%
  summarise(avg_dollar_loss = mean(estimated_dollar_loss))

downtown_cost_data <-
  select(fire_event_data, c("location", "estimated_dollar_loss")) %>%
  group_by(location) %>%
  summarise(avg_dollar_loss = mean(estimated_dollar_loss))

dt_residential <-
  downtown_data %>%
  filter(location == "residential") |>
  mutate(ignition_source = ave(ignition_source, ignition_source, FUN = function(i) replace(i, length(i) < 3, "other")))

```


# Analysis

```{r}
#| label: Fire events
#| fig-cap: Counts of fire Incident
#| echo: false
#| warning: false
#| message: true

fire_event_count <-
  ggplot(filter(fire_event_data, location!= "other"), aes(location, fill = location)) +
  geom_bar() +
  labs(x = "Location type", y = "Number of Events") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
    legend.position = "right"
  )
print(fire_event_count)
```

This data shows where across the GTA most fire incidences are occuring giving a clear understanding of where the most common places fire incidences occur. Locations outside or holding garbage are clear hotspots from this graph however as figure 2 shows the damage being done here is not as damaging as fires in other locations. This is not unexpected as damage originating garbage or grass fires are unlikely to be heavily represented in financial data. For policy makers this information should highlight an area that is in need of a solution. As figure 2 shows financially the benefit is prioritizing other types of incidents.

In figure 2 

```{R}
#| label: Incident Damages
#| fig-cap: Incident type damages
#| echo: false
#| warning: false
#| message: true

fire_event_cost_graph <-
  ggplot(filter(fire_event_costs, location != "institution"), aes(x = location, y = avg_dollar_loss, fill = location)) +
  geom_col() +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels
    legend.position = "right"
  )
print(fire_event_cost_graph)

```
